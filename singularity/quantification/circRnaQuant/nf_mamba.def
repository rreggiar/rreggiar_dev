Bootstrap: docker
From: python:3-slim

%environment

  export LC_ALL=C
  USER=${USER:-'rreggiar'}
  source /etc/conda/etc/profile.d/conda.sh
  conda activate circ_nf

%files

  env.yaml /etc/env.yaml

%post

  apt update
  apt install wget -y
  apt install curl -y
  apt install default-jre -y

  wget "https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-$(uname)-$(uname -m).sh"
  bash Miniforge3-$(uname)-$(uname -m).sh -b -p "/etc/conda"

  . ./etc/conda/etc/profile.d/conda.sh

  # adapted from https://github.com/telatin/getreads/blob/main/docs/INSTALLATION.md#manual-installation

  # Generate an environment with the required dependencies
  mamba create --name circ_nf
  conda activate circ_nf
  mamba install -y -c bioconda nextflow singularity
  mamba install -n circ_nf --file <(grep -v "@" /etc/requirements.txt)
